<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Piatto Virtuale ‚Äì Grigliata</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --accent: #ff7043;         /* arancione griglia */
      --accent-dark: #e36439;
      --bg-sky: #87ceeb;
      --bg-grass: #4caf50;
      --card-bg: rgba(255, 255, 255, 0.92);
      --card-border: rgba(255, 255, 255, 0.85);
      --text-main: #2f2f2f;
      --text-muted: #555;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background: linear-gradient(to bottom, var(--bg-sky) 0%, var(--bg-grass) 55%, #2e7d32 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .page-container {
      width: 100%;
      max-width: 1100px;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin: 6px 0 4px;
      font-size: clamp(1.6rem, 3vw, 2.2rem);
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.35);
    }

    .subtitle {
      text-align: center;
      color: #fbe9e7;
      font-size: 0.95rem;
      margin-bottom: 10px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }

    /* Barra superiore */
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 14px;
    }

    .top-bar input[type="text"] {
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.8);
      min-width: min(260px, 100%);
      background: rgba(255,255,255,0.95);
      font-size: 0.95rem;
      outline: none;
    }

    .top-bar input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(255,112,67,0.25);
    }

    .top-bar button {
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      font-weight: 700;
      font-size: 0.96rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      touch-action: manipulation;
    }

    .top-bar button.primary {
      background: linear-gradient(135deg, var(--accent), #ffb74d);
      color: #2b1b12;
      box-shadow: 0 3px 7px rgba(0,0,0,0.3);
    }

    .top-bar button.secondary {
      background: rgba(255,255,255,0.9);
      color: #4e342e;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .top-bar button span.emoji {
      font-size: 1.1rem;
    }

    .top-bar button:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    /* Layout principale */
    .layout {
      display: grid;
      grid-template-columns: 1.1fr 1.2fr;
      gap: 16px;
      align-items: flex-start;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 14px 14px 16px;
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
      backdrop-filter: blur(4px);
    }

    .card h2 {
      margin: 0;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card h2 span.emoji {
      font-size: 1.2rem;
    }

    .hint {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* Colonna alimenti */
    .food-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .food-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-radius: 12px;
      background: #fffdf8;
      border: 1px solid rgba(0,0,0,0.06);
      cursor: grab;
      touch-action: manipulation;
    }

    .food-item:active {
      cursor: grabbing;
    }

    .food-left {
      display: flex;
      align-items: center;
      gap: 9px;
      min-width: 0;
    }

    .food-icon {
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 30%, #ffffff, #ffe0b2);
      box-shadow: 0 2px 5px rgba(0,0,0,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      flex-shrink: 0;
    }

    .food-name {
      font-weight: 600;
      font-size: 0.93rem;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .food-controls {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .food-controls button {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }

    .food-controls button.minus { background: #ffcccb; }
    .food-controls button.plus  { background: #c8e6c9; }

    .food-qty {
      min-width: 22px;
      text-align: center;
      font-weight: 600;
      font-size: 0.95rem;
    }

    /* Colonna piatto */
    .plate-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 10px;
    }

    .plate {
      position: relative;
      width: min(360px, 80vw);
      height: min(360px, 80vw);
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
      box-shadow:
        0 14px 22px rgba(0,0,0,0.45),
        inset 0 3px 6px rgba(255,255,255,0.85),
        inset 0 -3px 6px rgba(0,0,0,0.15);
      border: 6px solid #fefefe;
      overflow: hidden;
    }

    .plate-inner {
      position: absolute;
      inset: 13%;
      border-radius: 50%;
      background: radial-gradient(circle, #fafafa, #dedede);
      border: 3px solid rgba(255,255,255,0.85);
    }

    .drop-zone {
      position: absolute;
      inset: 20%;
      border-radius: 50%;
      border: 2px dashed rgba(0,0,0,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 10px;
      font-size: 0.85rem;
      color: #777;
      background: radial-gradient(circle at 50% 20%, rgba(255,255,255,0.6), transparent);
    }

    .plate.drag-over .drop-zone {
      border-color: var(--accent);
      background: radial-gradient(circle at 50% 20%, rgba(255,255,255,0.9), rgba(255,224,178,0.35));
      color: #3e2723;
    }

    .plate-food-dot {
      position: absolute;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 2px 5px rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      pointer-events: none;
    }

    .plate-summary {
      margin-top: 6px;
      padding: 10px;
      border-radius: 12px;
      background: #fffdf8;
      border: 1px solid rgba(0,0,0,0.06);
      font-family: "SF Mono", "Consolas", "Courier New", monospace;
      white-space: pre-line;
      font-size: 0.9rem;
    }

    .plate-summary-title {
      font-weight: 700;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }

    .footer-note {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: right;
    }

    /* Responsiveness */
    @media (max-width: 800px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .card { padding: 12px 11px 14px; }

      .plate-wrapper { margin-top: 6px; }

      .plate {
        width: min(320px, 90vw);
        height: min(320px, 90vw);
      }

      .top-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .top-bar button {
        justify-content: center;
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .food-item { padding: 8px; }
      .food-name { font-size: 0.9rem; }
      .food-controls button {
        width: 30px;
        height: 30px;
      }
      .plate-summary { font-size: 0.86rem; }
    }
  </style>
</head>
<body>
  <div class="page-container">
    <h1>Piatto Virtuale ‚Äì Grigliata</h1>
    <p class="subtitle">Trascina la carne sul piatto, scegli le quantit√† e invia l‚Äôordine della grigliata üî•</p>

    <div class="top-bar">
      <input type="text" id="username" placeholder="Nome utente (es. Giovanni)" />
      <button class="primary" id="sendEmailBtn">
        <span class="emoji">üì®</span>
        <span>Invia piatto</span>
      </button>
      <button class="secondary" id="clearPlateBtn">
        <span class="emoji">üßπ</span>
        <span>Pulisci piatto</span>
      </button>
    </div>

    <div class="layout">
      <!-- Colonna alimenti -->
      <section class="card">
        <h2><span class="emoji">ü•©</span> Alimenti disponibili</h2>
        <p class="hint">
          Trascina un alimento nel piatto o usa i pulsanti + e ‚Äì per regolare le porzioni.
        </p>
        <div class="food-items" id="foodItems"></div>
      </section>

      <!-- Colonna piatto -->
      <section class="card">
        <h2><span class="emoji">üçΩÔ∏è</span> Piatto della grigliata</h2>
        <div class="plate-wrapper">
          <div class="plate" id="plate">
            <div class="plate-inner"></div>
            <div class="drop-zone" id="dropZone">
              Trascina qui fetta di carne, salsiccia, polpette, pollo, pane e insalata per comporre il piatto
            </div>
          </div>
        </div>
        <div class="plate-summary" id="plateSummary">
          <div class="plate-summary-title">Riepilogo piatto:</div>
          <div id="plateText">(nessun alimento selezionato)</div>
        </div>
        <div class="footer-note">
          Il piatto viene inviato a: <strong>danielespampinato00@gmail.com</strong>
        </div>
      </section>
    </div>
  </div>

  <script>
    // Email fissa del destinatario
    const FIXED_RECIPIENT = "danielespampinato00@gmail.com";

    // Definizione alimenti con icona emoji
    const foods = [
      { id: "carne",     name: "fetta di carne",       emoji: "ü•©" },
      { id: "salsiccia", name: "salsiccia",            emoji: "üå≠" },
      { id: "polpetta",  name: "polpetta di cavallo",  emoji: "üçñ" },
      { id: "pollo",     name: "petto di pollo",       emoji: "üçó" },
      { id: "pane",      name: "pane",                 emoji: "üçû" },
      { id: "insalata",  name: "insalata",             emoji: "ü•ó" }
    ];

    // Stato quantit√†
    const quantities = {};
    foods.forEach(f => quantities[f.id] = 0);

    // Riferimenti DOM
    const foodItemsContainer = document.getElementById("foodItems");
    const plate = document.getElementById("plate");
    const plateTextDiv = document.getElementById("plateText");
    const sendEmailBtn = document.getElementById("sendEmailBtn");
    const clearPlateBtn = document.getElementById("clearPlateBtn");
    const usernameInput = document.getElementById("username");

    // Render lista alimenti
    function renderFoodList() {
      foodItemsContainer.innerHTML = "";
      foods.forEach(food => {
        const item = document.createElement("div");
        item.className = "food-item";
        item.draggable = true;
        item.dataset.foodId = food.id;

        const left = document.createElement("div");
        left.className = "food-left";

        const icon = document.createElement("div");
        icon.className = "food-icon";
        icon.textContent = food.emoji;

        const nameSpan = document.createElement("span");
        nameSpan.className = "food-name";
        nameSpan.textContent = food.name;

        left.appendChild(icon);
        left.appendChild(nameSpan);

        const controls = document.createElement("div");
        controls.className = "food-controls";

        const minusBtn = document.createElement("button");
        minusBtn.textContent = "-";
        minusBtn.className = "minus";
        minusBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          changeQuantity(food.id, -1);
        });

        const qtySpan = document.createElement("span");
        qtySpan.className = "food-qty";
        qtySpan.id = "qty-" + food.id;
        qtySpan.textContent = "0";

        const plusBtn = document.createElement("button");
        plusBtn.textContent = "+";
        plusBtn.className = "plus";
        plusBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          changeQuantity(food.id, +1);
        });

        controls.appendChild(minusBtn);
        controls.appendChild(qtySpan);
        controls.appendChild(plusBtn);

        item.appendChild(left);
        item.appendChild(controls);

        // Drag & drop
        item.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", food.id);
        });

        foodItemsContainer.appendChild(item);
      });
    }

    // Modifica quantit√† + gestione icone sul piatto
    function changeQuantity(foodId, delta, options = {}) {
      const prev = quantities[foodId] || 0;
      const next = Math.max(0, prev + delta);
      const realDelta = next - prev;
      if (realDelta === 0) return;

      quantities[foodId] = next;

      const qtySpan = document.getElementById("qty-" + foodId);
      if (qtySpan) qtySpan.textContent = next;

      // aggiorna riepilogo testuale
      updatePlateText();

      // aggiorna piatto visivamente
      if (realDelta > 0) {
        for (let i = 0; i < realDelta; i++) {
          createFoodDotOnPlate(foodId, options.position || null);
        }
      } else if (realDelta < 0) {
        for (let i = 0; i < -realDelta; i++) {
          removeFoodDot(foodId);
        }
      }
    }

    // Testo piatto
    function getPlateText() {
      const lines = [];
      lines.push("Piatto virtuale:");
      let hasItems = false;
      foods.forEach(food => {
        const q = quantities[food.id];
        if (q > 0) {
          hasItems = true;
          lines.push(q + " x " + food.name);
        }
      });
      if (!hasItems) {
        lines.push("(nessun alimento selezionato)");
      }
      return lines.join("\n");
    }

    function updatePlateText() {
      plateTextDiv.textContent = getPlateText();
    }

    // Drag & drop sul piatto
    plate.addEventListener("dragover", (e) => {
      e.preventDefault();
      plate.classList.add("drag-over");
    });

    plate.addEventListener("dragleave", (e) => {
      if (!plate.contains(e.relatedTarget)) {
        plate.classList.remove("drag-over");
      }
    });

    plate.addEventListener("drop", (e) => {
      e.preventDefault();
      plate.classList.remove("drag-over");
      const foodId = e.dataTransfer.getData("text/plain");
      if (!foodId) return;

      const position = { x: e.clientX, y: e.clientY };
      changeQuantity(foodId, +1, { position });
    });

    // Crea un "boccone" sul piatto
    function createFoodDotOnPlate(foodId, position) {
      const rect = plate.getBoundingClientRect();

      let x, y;
      if (position) {
        x = position.x - rect.left;
        y = position.y - rect.top;
      } else {
        // posizione casuale all'interno del piatto
        const angle = Math.random() * 2 * Math.PI;
        const radius = (rect.width / 2) * (0.1 + Math.random() * 0.6);
        x = rect.width / 2 + Math.cos(angle) * radius;
        y = rect.height / 2 + Math.sin(angle) * radius;
      }

      const dot = document.createElement("div");
      dot.className = "plate-food-dot";
      dot.dataset.foodId = foodId;

      const food = foods.find(f => f.id === foodId);
      dot.textContent = food ? food.emoji : "üçΩÔ∏è";

      const offsetX = (x / rect.width) * 100;
      const offsetY = (y / rect.height) * 100;

      dot.style.left = `calc(${offsetX}% - 18px)`;
      dot.style.top  = `calc(${offsetY}% - 18px)`;

      plate.appendChild(dot);
    }

    // Rimuove un boccone dal piatto
    function removeFoodDot(foodId) {
      const dot = plate.querySelector(`.plate-food-dot[data-food-id="${foodId}"]`);
      if (dot) dot.remove();
    }

    // Pulisci piatto e quantit√†
    function clearPlate() {
      // azzera quantit√†
      foods.forEach(food => {
        quantities[food.id] = 0;
        const qtySpan = document.getElementById("qty-" + food.id);
        if (qtySpan) qtySpan.textContent = "0";
      });

      // rimuovi tutti i bocconi
      const dots = plate.querySelectorAll(".plate-food-dot");
      dots.forEach(d => d.remove());

      // aggiorna riepilogo
      updatePlateText();
    }

    clearPlateBtn.addEventListener("click", clearPlate);

    // Invio email (tramite mailto)
    sendEmailBtn.addEventListener("click", () => {
      const username = usernameInput.value.trim() || "Utente anonimo";

      const subject = "Composizione piatto virtuale";
      const bodyLines = [];
      bodyLines.push("Nome utente: " + username);
      bodyLines.push("");
      bodyLines.push(getPlateText());

      const body = bodyLines.join("\n");
      const mailtoUrl =
        "mailto:" + encodeURIComponent(FIXED_RECIPIENT) +
        "?subject=" + encodeURIComponent(subject) +
        "&body=" + encodeURIComponent(body);

      window.location.href = mailtoUrl;
    });

    // Init
    renderFoodList();
    updatePlateText();
  </script>
</body>
</html>
